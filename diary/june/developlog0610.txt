개발 19일차
갑자기 내가 왜 개발 일지 첫 부분 마다 일기처럼 쓰는 지 생각해 봤다. 아마 이런거 일 거다. 
회의에서 딱딱한 분위기를 부드럽게 만들기 위해 처음에 인사말을 나누거나 날씨에 대한 이야기를 하거나 
우스게소리를 하는 것들처럼 내가 개발일지 첫부분을 그렇게 쓰는 거라고 처음부터 개발과 상관없는 이야기를 하는거라고
생각이 된다. 그 다음 생각 나는건 지금 내가 만들고 있는 토이 프로젝트는 목적성이 희박한 여러 api들을 합쳐
만들고 있는 것이라고 생각이 든다. 목적성이 희미 하기 때문에 무언가 진행 방향이 안잡힌다고 할까 내가 이 프로젝트에 분명한 목적을 잡고 
해야하는 것일까라는 의문이 든다. 그냥 토이 프로젝트인데 분명한 목적이 필요할까 라는 생각이 들기도 하고 기능 구현들을 하나씩
하다 보면 무언가 하고 싶어 질지도?
 fetch api에서 stream이 작동하지 않는다는 stackoverflow의견이 있다. (Fetch is not really able to work with nodejs Streams out of the box)
이 글의 결론은 nodejs에서 제공하는 stream api를 사용하라는 건데 그게 싫어서 여태까지 노력했던건데 결국한 nodejs에서 제공하는 패키지들을
사용할 수 밖에 없는 것 같다. 머리 속이 복잡하다. electron-fetch로 다운로드 할 수 있을 거라 생각했는데 electron-updater가 저 패키지에 대해
에러를 일으킨다고 한다. autoLogin도 무언가 잘못된듯 인증을 요구 하고 있고 아닌가 이번엔 되네 아 서버 껏다 켜서 세션이 날아갔구나
electron fetch를 건너 뛰고 electron-dl로 바꾸어 적용 시켜보았다. 전에도 시도해본적은 있지만 사용법을 이해 하기 못해서 시간만 버리고
그만 뒀었지만 지금 이해할 수 있는 부분이 생겨 적용 했더니 다운로드가 된다 진짜 된다 다만 한글은 지원이 안됬는지 한글 이름이 없어진 파일이 다운로드
되긴하지만 진짜 다운이 된다. 진짜 서버에 있는 파일이 다운된다. 어플리케이션이 지원한는 파일 다운로드 ui가 따로 있어서 내가 구현했던 알람기능을
제거하였다. 이제 한글 문제를 해결해 봐야겠다. 해결방법을 찾다가 어플리케이션 버전 관리하기에 좋은 걸 찾았다. electron-updater라는 건데
github와 연동하여 파일 체크와 업데이트 기능을 제공하여 버전 관리 기능한다고 한다. 좀 더 구체적인건 실제 작업에 들어갔을때 해보기로 하자.
다운로드 진행 정도를 알 수 있는 기능을 추가해서 다운로드 중을 나타낼려고 했는데 promise 구문 안에 vue 객체이용이 안됬던데 기억났다. 역시 잘 안된다.
다운로드 진행을 기준으로 잡을 수 없게 되니 별로다 알람 기능을 지워버릴려고 했는데 반복문 안에 되지 않는 걸로 되서 좀 더 지켜보기로 하였다.
그리고 아까 전에 알아놓은 것을 적어놓는다. spring security는 유저토큰을 저장하지 않는 줄 알았는데 그게 아니였다. 서버가 활성화 되 있는 동안은 
저장되 있고 꺼질 때 기억하지 못해 삭제 되며 꺼지기 전에 만들어 놓았던 토큰들은 무효화 된다. 왜 인지 모르겠지만 this안에 this를 다시 사용하지 못했다.
그렇다면 약간의 구조 변경으로 내가 원하는 다운로드 프로그레스를 만들 수 있을 것다. for( v of it) 형식의 반복문 안에 넣고 돌려보았다.
다행이다 정상작동한다. 지금은 로컬 서버라 속도도 빨르고 용량도 적어서 퍼센트를 제대로 나타내진 못하지만 느린 환경이라면 충분히 될 것이다.
과장님이 tomcat 대신 undertow를 한번 써보라 하신데 이게 더 빠르고 가볍다고 해서 한번 찾아보았다. 메뉴얼대로 했다 안된다. gradle에 등록도 했고
configuration도 했고 build도 다시 해보고 다 해봤지만 계속 tomcat으로 booting 된다. vscode에서 설정으로 서버가 고정되 있는지 확인할 필요가 있다.
서버 설정이 없다. 임베디드 톰캣만 쓰다가 바꿀려다보니 어떻게 바꿔야 할지 모르겠다. 그 전에 파일 다운로드에 대해서 파일 다운로드시 폴더를 만드는 작업을
하게 될 때 폴더 명은 한글로 잘만 만든다. 근데 파일은 한글을 못쓴다. 이유가 있을 것 같다. gradle build를 이것 저것 만지다 보니깐 undertow가 됬다.
내 행동 땜에 적용이 된건지 서버를 자꾸 껏다 켜서 그런건지는 잘 모르겠다. 다행이도 서버간 통신은 문제 없는 것 같다. 내장톰캣과 같은 파일위치를 공유하는지
업로드 다운로드도 정상작동한다. 파일 다운로드 프로그레스가 맘에 들지 않지만 적용시키긴 했다. 프로그레스 정도를 나타내는 것은 리소스를 크게 낭비하는 것처럼 
보인다. 파일 다운로드 상태를 계속 해서 응답을 받아야 하는데 다운로드 받는 것이 여러개다 보니 내가 원하는 하나의 상태 프로그레스를 나타내는 건 힘들 것 같다.
그래서 indeterminate를 활용할려 한다. (node:21212) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 download progress listeners added. Use emitter.setMaxListeners() to increase limit
라는 에러가 뜨길로 검색해봤더니 nodejs에서 등록할 수 있는 이벤트 갯수제한에 대해 적혀 있다. 내가 작성했던 method 구조를 보니 반복문안에 이벤트를 등록하는 
명령문을 넣어놓았다. 이걸 mount에 옮겼다. 별 문제 없이 된다. 지도 api를 활용한 어플리케이션을 만들고 싶어서 지도 api들을 검색해 보았는데 
구글 지도 같은 경우에는 부분 유료화 되어있고 다음 지도는 1일 30만회까지 무료라고 한다. 일단 무료라니깐 신청해보고 어디까지 기능이 지원될 지 봐야겠다.